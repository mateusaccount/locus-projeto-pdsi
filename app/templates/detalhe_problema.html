{% extends 'base.html' %}
{% load static %}
{% block title %}{{ problema.titulo }} - Locus{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto pb-12">
    
    <div class="mb-6">
        <a href="{% url 'app:lista_problemas' %}" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-red-600 transition-colors">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
            Voltar para o Mural
        </a>
    </div>

    <div class="bg-gradient-to-br from-red-600 to-red-800 rounded-3xl p-8 md:p-12 text-white shadow-lg mb-8 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
        
        <div class="relative z-10 flex flex-col md:flex-row justify-between items-start gap-6">
            <div class="space-y-4">
                <div class="flex items-center gap-3">
                    <span class="px-3 py-1 rounded-full bg-white/20 backdrop-blur-md border border-white/20 text-xs font-bold uppercase tracking-wider shadow-sm">
                        Ocorrência em Aberto
                    </span>
                    <span class="text-sm text-red-100 font-medium">Reportado em {{ problema.data_criacao|date:"d/m/Y" }}</span>
                </div>
                
                <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight leading-tight">
                    {{ problema.titulo }}
                </h1>
                
                <div class="flex items-center gap-2 text-red-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    <span class="text-lg font-medium">{{ problema.localizacao|default:"Localização não especificada" }}</span>
                </div>
            </div>

            <div class="hidden md:block bg-white/10 p-4 rounded-2xl border border-white/10 backdrop-blur-sm">
                <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-8">
            
            <div class="bg-white rounded-2xl p-8 border border-gray-100 shadow-sm">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/></svg>
                    Descrição da Situação
                </h2>
                <div class="prose prose-red max-w-none text-gray-600 leading-relaxed">
                    {{ problema.descricao|linebreaks }}
                </div>
            </div>

            <div class="bg-white rounded-2xl p-8 border border-gray-100 shadow-sm relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-[#2F7E32]"></div> <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                        <svg class="w-5 h-5 text-[#2F7E32]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        Soluções Propostas
                    </h2>
                    <span class="bg-green-100 text-[#2F7E32] text-xs font-bold px-2 py-1 rounded-full">
                        {{ problema.ideia_set.count }} </span>
                </div>

                {% if problema.ideia_set.all %}
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% for ideia in problema.ideia_set.all %}
                        <a href="{% url 'app:detalhe_ideia' ideia.id %}" class="group block bg-white border border-gray-200 rounded-xl p-4 hover:border-[#2F7E32] hover:shadow-md transition-all">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-gray-800 group-hover:text-[#2F7E32] transition-colors line-clamp-1">{{ ideia.titulo }}</h3>
                                <span class="bg-green-50 text-[#2F7E32] text-xs font-bold px-2 py-1 rounded-lg">{{ ideia.pontuacao }} pts</span>
                            </div>
                            <p class="text-sm text-gray-500 line-clamp-2 mb-3">{{ ideia.descricao }}</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <div class="h-6 w-6 rounded-full bg-gray-100 flex items-center justify-center font-bold">
                                    {{ ideia.autor.username|slice:":1"|upper }}
                                </div>
                                <span>{{ ideia.autor.username }}</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-200">
                        <p class="text-gray-500 mb-3">Nenhuma solução foi proposta para este problema ainda.</p>
                        <a href="{% url 'app:submeter_ideia' %}?problema={{ problema.id }}" class="inline-flex items-center text-sm font-bold text-[#2F7E32] hover:underline">
                            Seja o primeiro a propor uma ideia
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>
                        </a>
                    </div>
                {% endif %}
            </div>

            {% if problema.imagem %}
            <div class="bg-white rounded-2xl p-8 border border-gray-100 shadow-sm">
                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    Evidência Anexada
                </h2>
                <div class="rounded-xl overflow-hidden border border-gray-100 bg-gray-50">
                    <img src="{{ problema.imagem.url }}" alt="{{ problema.titulo }}" class="w-full h-auto object-cover hover:opacity-95 transition-opacity cursor-pointer">
                </div>
            </div>
            {% endif %}

        </div>

        <div class="space-y-6">
            
            <div class="bg-white rounded-2xl shadow-lg shadow-green-900/5 border-2 border-[#2F7E32] p-6 text-center relative overflow-hidden group">
                <div class="absolute inset-0 bg-green-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative z-10">
                    <h3 class="text-lg font-bold text-gray-900 mb-2">Você tem a solução?</h3>
                    <p class="text-gray-500 text-sm mb-6">Transforme este problema em uma melhoria para o campus.</p>
                    
                    <a href="{% url 'app:submeter_ideia' %}?problema={{ problema.id }}" class="flex items-center justify-center w-full py-3.5 px-6 bg-[#2F7E32] text-white rounded-xl font-bold hover:bg-[#266e29] hover:shadow-lg transition-all transform hover:-translate-y-0.5">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                        Propor Ideia
                    </a>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Reportado por</h3>
                <div class="flex items-center gap-4">
                    <div class="h-12 w-12 rounded-full bg-red-50 border border-red-100 flex items-center justify-center text-lg font-bold text-red-600">
                         {{ problema.autor.username|slice:":1"|upper }}
                    </div>
                    <div>
                        <p class="font-bold text-gray-900">{{ problema.autor.first_name|default:problema.autor.username }}</p>
                        <p class="text-xs text-gray-500">Membro da Comunidade</p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}